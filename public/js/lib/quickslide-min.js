
var QuickSlideConfig;(function(config){"use strict";var popupImg,popupBox,dimmer,popupCaption,sizeTimer,popupNext,popupPrev,normalizeEvent,addListener,delegateListener,triggerEvent,init,setupGalleryLinks,setPopup,recenterBox,showImage,hidePopup;if(document.getElementById("quickslide-popup-box")||document.getElementById("lightbox")){return;}
normalizeEvent=function(e){if(!e.stopPropagation){e.stopPropagation=function(){this.cancelBubble=true;};e.preventDefault=function(){this.returnValue=false;};}
if(e.srcElement&&!e.target){e.target=e.srcElement;}
return e;};addListener=function(node,type,handler){var wrapHandler=function(e){handler.apply(node,[normalizeEvent(e||window.event)]);};if(node.attachEvent){node.attachEvent("on"+type,wrapHandler);}else{node.addEventListener(type,wrapHandler,false);}
return{node:node,type:type,handler:wrapHandler};};triggerEvent=function(node,type){var evt;if(document.createEventObject){evt=document.createEventObject();return node.fireEvent("on"+type,evt);}else{evt=document.createEvent("HTMLEvents");evt.initEvent(type,true,true);return!node.dispatchEvent(evt);}};setupGalleryLinks=function(){var isImageLink,isQ;isImageLink=function(link){var href=link.getAttribute("href"),imgExt=/\.(jp(e?)g|png|gif)$/i,redirect=/=http/;return imgExt.test(href)&&!redirect.test(href);};isQ=function(testEl){var nodeName=testEl.nodeName.toUpperCase(),rel=(testEl.getAttribute("rel")||"").toUpperCase();return nodeName==="A"&&(rel==="QUICKSLIDE"||(config.auto_detect&&isImageLink(testEl)));};addListener(document.body,"click",function(e){var el=e.target;if(e.shiftKey){e.shiftKey=false;return false;}
if(e.button&&e.button===1){return true;}
while(el&&!isQ(el)&&el!==this){el=el.parentNode;}
if(el&&isQ(el)){e.preventDefault();setPopup(el);}});};recenterBox=function(box,srcImg){var bs=box.style,cw,ch,scrollTop=document.body.scrollTop||(document.documentElement&&document.documentElement.scrollTop),px=0,py=0,w,h,cr,mw=config.max_width,mh=config.max_height;cw=window.innerWidth||document.documentElement.clientWidth;ch=window.innerHeight||document.documentElement.clientHeight;if(srcImg){w=srcImg.width;h=srcImg.height;if(mw&&w>mw){h=Math.round(h*mw/w);w=mw;srcImg.style.maxWidth=mw+"px";srcImg.style.maxHeight=h+"px";}
if(mh&&h>mh){w=Math.round(w*mh/h);h=mh;srcImg.style.maxHeight=mh+"px";srcImg.style.maxWidth=w+"px";}
if(config.show_caption){popupCaption.style.maxWidth=w+"px";}
px=box.offsetWidth-w;py=box.offsetHeight-h;if(config.auto_fit!==false){if(w+px>cw){h=Math.round(h*(cw-px)/w);w=cw-px;srcImg.style.maxWidth=w+"px";srcImg.style.maxHeight=h+"px";}
if(h+py>ch){w=Math.round(w*(ch-py)/h);h=ch-py;srcImg.style.maxHeight=h+"px";srcImg.style.maxWidth=w+"px";}}}else{cr=box.getBoundingClientRect();w=cr.right-cr.left;h=cr.bottom-cr.top;}
bs.top=(Math.round((ch-h)/2)+
(config.absolute_position?scrollTop:0)-
(py/2))+"px";bs.left=(Math.round((cw-w)/2)-px/2)+"px";};setPopup=function(fromNode){var spinnerURL;if(config.use_dimmer){dimmer.style.display="";}
popupBox.className="loading";popupBox.style.display="";if(config.chrome_extension){}
recenterBox(popupBox);if(popupImg&&popupImg.parentNode===popupBox){popupBox.removeChild(popupImg);}
popupImg=new Image();popupImg.id="quickslide-image";popupImg.style.display="none";addListener(popupImg,"error",function(err){if(!popupImg.width&&!popupImg.height){hidePopup();window.location=popupImg.src;}});if(config.show_caption){popupCaption.style.display="none";popupCaption.innerHTML=fromNode.getAttribute("title");}
addListener(popupImg,"load",function(){popupBox.className="loaded";});popupImg.src=fromNode.getAttribute("href");sizeTimer=setInterval(function(){if(popupImg.width||popupImg.height){clearInterval(sizeTimer);showImage();}},100);};showImage=function(){popupBox.className="";popupImg.style.display="";if(config.show_caption){popupBox.insertBefore(popupImg,popupCaption);popupCaption.style.display="";}else{popupBox.appendChild(popupImg);}
recenterBox(popupBox,popupImg);};hidePopup=function(){clearInterval(sizeTimer);if(popupBox.parentNode===document.body){popupBox.style.display="none";if(config.use_dimmer){dimmer.style.display="none";}}};init=function(){var s;popupBox=document.createElement("div");popupBox.id="quickslide-popup-box";s=popupBox.style;s.position=config.absolute_position?"absolute":"fixed";s.zIndex="9999";s.display="none";if(config.chrome_extension){s=chrome.extension.getURL("loading-spinner.gif");popupBox.style.backgroundImage=["url(",s,")"].join("'");}
addListener(popupBox,"click",function(e){hidePopup();});document.body.appendChild(popupBox);if(config.use_dimmer){dimmer=document.createElement("div");dimmer.id="quickslide-dimmer";s=dimmer.style;s.position="fixed";s.zIndex="9998";s.top="0";s.right="0";s.bottom="0";s.left="0";s.display="none";addListener(dimmer,"click",function(e){hidePopup();});addListener(document.body,"keydown",function(e){if(e.keyCode===27){hidePopup();}});document.body.appendChild(dimmer);}
if(config.show_caption){popupCaption=document.createElement("div");popupCaption.id="quickslide-caption";popupBox.appendChild(popupCaption);}
setupGalleryLinks();};if(config.chrome_extension){chrome.extension.sendRequest({func:"getConfig"},function(response){var c=response.config;config.max_width=c.max_width;config.max_height=c.max_height;config.use_dimmer=c.use_dimmer;config.absolute_position=c.absolute_position;config.show_caption=c.show_caption;config.auto_fit=c.auto_fit;config.auto_detect=true;config.no_wait=true;init();});}else{if(config.no_wait&&document.body){init();}else{addListener(window,"load",function(){init();});}}}(QuickSlideConfig||{}));